## Provides Helper functions for standard problems with my benchmarking data
# define helper functions

### Load Data


load_data_file <- function (file, row_names) {
  if (missing(row_names)) {
    # these row names are hard coded and might not be applicable
    # names like this are generated by ReBench
    row_names <- c("Time", "Benchmark", "VirtualMachine", "Platform",
                  "ExtraArguments", "Cores", "Iterations", "None", "Criterion")
  }

  bench <- rbind(read.table(file,
                            sep="\t", header=FALSE, col.names=row_names, fill=TRUE))
  bench
}
 

load_data <- function () {
  # REM: the row names are hard coded and could have changed
  rowNames <- c("Time", "Benchmark", "VirtualMachine", "Platform",
                "ExtraArguments", "Cores", "Iterations", "None", "Criterion")

  bench <- rbind(read.table("osx.data.csv",
                            sep="\t", header=FALSE, col.names=rowNames),
                 read.table("ubuntu.data.csv",
                            sep="\t", header=FALSE, col.names=rowNames),
                 read.table("tilera.data.csv",
                            sep="\t", header=FALSE, col.names=rowNames))
  bench
}

# Prepare some readable/shorter names for the plots, hope we can map that somehow
bench_names <- function() {
  data.frame( "BenchmarkGameSuite.benchFasta.%(cores)s 1 15000"="Fasta",
                          "BenchmarkGameSuite.benchNBody.%(cores)s 1 4000" = "NBody", 
                          "BenchmarkGameSuite.benchFannkuchRedux.%(cores)s 1 7"="FannkuchRedux",
                          "BenchmarkGameSuite.benchBinaryTrees.%(cores)s 1 9" = "BinaryTrees", 
                          "SMarkLoops.benchIntLoop.%(cores)s 30"="Int Loop (1 proc per core)",
                          "SMarkCompiler.%(cores)s 50"="Compiler", 
                          "SMarkLoops.benchFloatLoop.%(cores)s 9"="Float Loop (1 proc per core)",
                          "SMarkLoops.benchFloatLoop.%(cores)s0 5"="Float Loop (10 procs per core)",
                          "SMarkLoops.benchIntLoop.%(cores)s0 5"="Int Loop (10 procs per core)",
                          "BenchmarkGameSuite.benchChameleons.None"="Chameleons")
}

custom_scale <- function(theFactor) {
  factor_levels <- levels(theFactor)
  structure(1:length(factor_levels), names=factor_levels)
}

### Work with the Data

confInterval095Error <- function (samples) {
  if (length(sample) < 30)
    qnorm(0.975) * sd(samples) / sqrt(length(samples))
  else
    qt(0.975, df=length(samples)-1) * sd(samples) / sqrt(length(samples))
  }
  
drop_unused_factors <- function (dataSet) {
  dataSet[] <- lapply(dataSet, function(x) if (is.factor(x)) factor(x) else x)
  dataSet
}

map_names <- function(old_names, name_map) {
  for (i in 1:length(old_names)) {
    old_name <- old_names[[i]]
    if (!is.null(name_map[[old_name]])) {
      old_names[i] <- name_map[[old_name]]
    }
  }
  old_names
}

## This function generates a nice logarithmic axis label
## x can be a sequence.
## Usage: logarithmic_axis_labels(seq(1, 10, by=0.5))
logarithmic_axis_labels <- function (x, base = 10, digits = 2) {
  round(base^x, digits = digits)
}
